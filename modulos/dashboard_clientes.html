<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard de Clientes</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { margin: 0; font-family: 'Inter', sans-serif; background: #f4f6fa; display: flex; }
    .sidebar { width: 220px; background: #fff; height: 100vh; padding: 20px 10px; border-right: 1px solid #ddd; box-shadow: 2px 0 5px rgba(0,0,0,0.05); }
    .sidebar h2 { margin: 0; font-size: 18px; text-align: center; }
    .nav { margin-top: 30px; }
    .nav a { display: flex; align-items: center; padding: 10px 16px; margin: 4px 0; border-radius: 8px; text-decoration: none; color: #333; }
    .nav a:hover, .nav a.active { background: #e0edff; color: #1d4ed8; }
    .main { flex: 1; padding: 30px; }
    table { width: 100%; background: #fff; border-collapse: collapse; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    th, td { padding: 12px; text-align: left; }
    th { background-color: #f0f2f5; }
    .form-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    .form-box { background: #fff; padding: 20px; border-radius: 12px; width: 400px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    .form-box input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>ERP System</h2>
    <div class="nav">
      <a href="dashboard_inventario.html">üì¶ Invent√°rio</a>
      <a href="dashboard_producao.html">üè≠ Produ√ß√£o</a>
      <a href="dashboard_compras.html">üõí Compras</a>
      <a href="dashboard_projetos.html">üìÅ Projetos</a>
      <a href="dashboard_vendas.html">üí∞ Vendas</a>
      <a href="dashboard_clientes.html" class="active">üë• Clientes</a>
      
      
      

    </div>
  </div>

  <div class="main">
    <h1>Clientes</h1>
    <button onclick="abrirModal()">‚ûï Novo Cliente</button>
    <div id="modalCliente" class="form-modal" style="display: none;">
      <div class="form-box">
        <button onclick="fecharModal()" style="float:right;">X</button>
        <h3>Adicionar Cliente</h3>
        <input type="text" id="nomeCliente" placeholder="Nome">
        <input type="email" id="emailCliente" placeholder="Email">
        <input type="text" id="telCliente" placeholder="Telefone">
        <button onclick="salvarCliente()">Salvar</button>
      </div>
    </div>
    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>Telefone</th>
        </tr>
      </thead>
      <tbody id="listaClientes">
        <tr><td colspan="3">Carregando...</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    const supabase = window.supabase.createClient(
      'https://nnitvxhubovlyfxdeemf.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5uaXR2eGh1Ym92bHlmeGRlZW1mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNjU4ODYsImV4cCI6MjA2Mzg0MTg4Nn0.fTwCna-UBzfLRlbJ2EkWwQeXuq5t3ORwfgbsfiUqejU'
    );

    async function carregarClientes() {
      const { data: sessionData } = await supabase.auth.getSession();
      const user = sessionData?.session?.user;
      if (!user) return alert("Usu√°rio n√£o autenticado.");

      const { data, error } = await supabase.from("clientes").select("*").eq("usuario_id", user.id);
      const lista = document.getElementById("listaClientes");

      if (error || !data.length) {
        lista.innerHTML = '<tr><td colspan="3">Nenhum cliente encontrado.</td></tr>';
        return;
      }

      lista.innerHTML = data.map(c => `
        <tr>
          <td>${c.nome}</td>
          <td>${c.email || ''}</td>
          <td>${c.telefone || ''}</td>
        </tr>`).join('');
    }

    function abrirModal() {
      document.getElementById("modalCliente").style.display = "flex";
    }
    function fecharModal() {
      document.getElementById("modalCliente").style.display = "none";
    }

    async function salvarCliente() {
      const { data: sessionData } = await supabase.auth.getSession();
      const user = sessionData?.session?.user;
      if (!user) return alert("Usu√°rio n√£o autenticado.");

      const cliente = {
        nome: document.getElementById("nomeCliente").value,
        email: document.getElementById("emailCliente").value,
        telefone: document.getElementById("telCliente").value,
        usuario_id: user.id
      };

      const { error } = await supabase.from("clientes").insert([cliente]);
      if (error) return alert("Erro ao adicionar cliente: " + error.message);

      alert("Cliente adicionado com sucesso!");
      fecharModal();
      carregarClientes();
    }

    window.addEventListener("DOMContentLoaded", carregarClientes);
  </script>
</body>
</html>
